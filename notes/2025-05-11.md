controller가 흐름제어까지 책임을 가지면 안되는 이유 : 
계층간 책임이 흐려지고 단위테스트가 어려워짐 

## 테스트코드 
슬라이스 테스트 
contoller 에서 
```kotlin 
@WebMvcTest(OrderController.class)
class OrderControllerTest {

    @Autowired
    private MockMvc mockMvc;

    @MockBean
    private OrderService orderService;

    @Test
    void 주문_취소_요청시_정상응답을_반환한다() throws Exception {
        // given
        Long orderId = 1L;
        doNothing().when(orderService).cancelOrder(orderId);

        // when & then
        mockMvc.perform(post("/orders/{id}/cancel", orderId))
            .andExpect(status().isOk());
    }
}
```

repository에서 
```kotlin 
@DataJpaTest
class OrderRepositoryTest {

    @Autowired
    private OrderRepository orderRepository;

    @Test
    void 주문을_저장하고_조회할_수_있다() {
        Order order = Order.create("상품A", 2);
        orderRepository.save(order);

        Order found = orderRepository.findById(order.getId()).orElseThrow();
        assertThat(found.getProductName()).isEqualTo("상품A");
    }
}
```

비지니스 흐름은 junit + mock 단위 테스트 

domain model 테스트는 순수 언어? 테스트로도 가능 

통합테스트는 주요시나리오 테스트 해야할때 


spock 은 bdd기반의 자연어적인 groovy 기반의 테스트 프레임워크 
요즘 java/kotlin 쪽과 충돌 발생하기도 하고 springboot 기본이 junit 이며 기피한다 
매개변수가 많고 여러 데이터에 따른 테스트에 유리

테스트더블은 테스트코드에서 실제 객체를 대신해서 사용되는 대체 객체 
1. **Dummy**
   - 목적: 값 채우기용. 실제 로직은 없음
   - 예시: `new DummyUser()`

1. **Fake**
   - 목적: 단순 구현체. 실제 동작하지만 가벼움
   - 예시: `InMemoryUserRepository` (DB 대신 메모리 리스트 사용)

1. **Stub**
   - 목적: 고정된 값을 반환
   - 예시: `when(user.getName()).thenReturn("Grimoire");`

4. **Spy**
   - 목적: 실제 동작하면서 호출 여부, 인자 기록
   - 예시: `verify(spyService).run();`

5. **Mock**
   - 목적: 사전에 정의한 동작 및 기대를 검증
   - 예시: `verify(mock).calledWith("param");`


 1. 단위 테스트(Unit Test)
- **가장 작은 단위(클래스/함수)를 독립적으로 검증**
- 외부 시스템(DB, 네트워크 등)에 의존하면 안 됨
- **빠르고 고립적**이어야 함

테스트의 3단계 (AAA 패턴)

1. **Arrange**: 테스트 준비

2. **Act**: 실제 코드 실행

3. **Assert**: 결과 검증

  

```java

// Arrange

Calculator calc = new Calculator();

  

// Act

int result = calc.add(2, 3);

  

// Assert

assertEquals(5, result);

```


좋은 테스트의 특징
- **FAST**: 빠르고
- **ISOLATED**: 고립되며
- **REPEATABLE**: 반복 가능하고
- **SELF-VALIDATING**: 결과 자동 검증
- **TIMELY**: 코드 작성 직후 바로 작성됨

