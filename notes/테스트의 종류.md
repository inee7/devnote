---
tags: [testing, test-pyramid, unit-test, integration-test, e2e-test, slice-test]
---
# 유닛, 슬라이스, 통합, E2E 테스트

- 유닛(Unit): 순수 로직만 빠르게 검증. 외부 의존성 없음. 가장 많고 빠르게.
- 슬라이스(Slice): 스프링의 “한 계층만” 올려 부분 통합 검증(@WebMvcTest, @DataJpaTest 등).
- 통합(Integration): 스프링 전체 컨텍스트 + 실제 인프라(DB 등) + 외부는 대개 Mock/WireMock.
- E2E(End-to-End): 실제 HTTP 요청으로 컨트롤러DB필터/시큐리티까지 전체 경로 확인. 극소수 스모크만.
권장 비율(대략): 유닛 60-70% / 슬라이스 10-20% / 통합 20-30% / E2E 0-5%(스모크 2~5개).

## 테스트 레벨별 정의와 목적

### Unit (유닛 테스트)
- 목적: 함수/클래스의 순수 로직 검증(계산, 정책, 도메인 규칙).
- 환경: JUnit만, 스프링 컨텍스트/DB 없음. 의존성은 [[테스트더블]](Mock/Fake)로 대체.
- 이점: 실행 매우 빠름, 리팩터링에 강함.
- 상세 원칙: [[unit-test]], [[testing-conditions]]
- 도구: [[Junit]], AssertJ, Mockito/MockK.

### Slice (슬라이스 테스트)
- 목적: 특정 계층의 스프링 설정/매핑 검증(부분 통합).
    예) @WebMvcTest(컨트롤러·검증·Advice·필터), @DataJpaTest(엔티티 매핑·쿼리).
- 환경: 스프링 컨텍스트 “일부” 로드. 타 계층은 @MockBean으로 대체.
- 이점: 통합보다 빠르고, 유닛보다 현실적.
- 상세: [[슬라이스 테스트]]
- 도구: MockMvc(@WebMvcTest), TestEntityManager/@DataJpaTest.

### Integration (통합 테스트)
- 목적: 유스케이스/서비스 흐름, 트랜잭션, DB 정합성, 외부 연동 포인트 검증.
- 환경: @SpringBootTest로 전체 컨텍스트 + Testcontainers(DB), 외부는 WireMock 등    
- 이점: 실제 동작에 가장 근접한 검증(전송 계층 제외).
- 도구: SpringBootTest, Testcontainers(Postgres/Redis 등), WireMock.

### E2E (엔드투엔드 테스트)
- 목적: 실제 HTTP 요청으로 API 계약/보안/필터/Jackson/Advice까지 최종 확인.
- 환경: SpringBootTest + MockMvc(가짜 서블릿) 또는 webEnvironment=RANDOM_PORT + TestRestTemplate/WebTestClient(실제 소켓).
- 이점/비용: 가장 현실적이나 가장 느림·불안정. 핵심 경로 스모크에만 사용.


## 각 레벨에서 “무엇을 테스트/비테스트”로 삼을지

### Unit
- 반드시: 반환값/상태변화/이벤트 등 결과 중심, 규칙 경계값, 예외 케이스.
- 가급적 아님: 내부 호출 횟수/순서(계약이 아니라면).

### Slice
- @WebMvcTest: 바인딩(@Valid), 상태코드, 에러 응답 스펙(JSONPath), 라우팅.
- @DataJpaTest: 엔티티 매핑, 쿼리 메서드/JPQL 동작, 영속성 컨텍스트 동작.
- 가급적 아님: 도메인 흐름 전부(그건 통합이 맡음).

### Integration
- 반드시: 트랜잭션 경계, 저장→조회 정합성, 외부 연동 실패/재시도/폴백 정책, 아웃박스/이벤트 발행.
- 가급적 아님: HTTP 직렬화/필터/보안(그건 E2E/슬라이스).

### E2E
- 반드시: 실제 요청/응답 포맷(JSON), 보안 필터/헤더, Advice 에러 스키마, 콘텐츠 협상(415/406).
- 가급적 아님: 모든 시나리오 전부(핵심 경로만 스모크).
