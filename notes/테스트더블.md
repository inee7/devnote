---
tags: [testing, test-double, mock, stub, spy]
---
# 테스트 더블(Test Double)

- `테스트 더블`은 [[unit-test]]의 원칙 중 **고립성(Isolated)**을 지키기 위한 핵심 기술입니다. 이 기술을 통해 테스트를 더 견고하고 빠르게 만들 수 있습니다.

## 한 줄 결론
- **Test Double**은 실제 협력자를 대체하는 모든 가짜 객체의 총칭.  
  유형: **Dummy, Fake, Stub, Spy, Mock**.
- **JUnit**은 테스트 **실행 프레임워크**일 뿐 Mock 개념을 제공하지 않는다.  
  **MockK/Mockito** 같은 라이브러리가 **Stub(결과 지정)** 과 **Mock(행위 검증)** 기능을 가진 프록시를 만든다.
- `every { ... } returns ...` → **Stub 동작**(결과 제어),  
  `verify { ... }` → **Mock 동작**(호출/행위 검증),  
  `spyk()` → **Spy**(실제 동작 + 호출기록),  
  **Fake**는 단순 구현체, **Dummy**는 사용되지 않는 자리채움 값.

---

## 1) 용어와 역할 요약

| 유형 | 핵심 목적 | 무엇을 검증/제어? | 예시 상황 |
|---|---|---|---|
| **Dummy** | 자리 채움 | 사용되지 않음 | 예외적으로 파라미터 채우기용 |
| **Fake** | 단순 실제 구현 | 간단한 대체 DB/캐시 | In-memory Repository |
| **Stub** | **결과 제어** | “무엇을 반환하나?” | 외부 API/DB 결과를 고정 |
| **Spy** | 실제+기록 | 실제 동작 + 호출 기록 | 부분 모킹/호출 여부 확인 |
| **Mock** | **행위 검증** | “어떻게 호출됐나?” | 횟수/인자/순서 검증 |

> 현실에서는 MockK/Mockito가 생성한 **“mock 객체”** 안에 Stub/Mock/Spy 기능이 모두 들어있어,  
> “mock을 만든다”라고 말해도 실제로는 **stub으로 값 지정 + verify로 행위 검증**을 함께 사용합니다.

---
## 2) 언제 무엇을 쓰나? (실무 기준)

- **Stub**: 결과만 제어하고 싶을 때  
- **Mock**: 특정 행위(호출/순서)를 검증할 때  
- **Spy**: 실제 동작 + 호출 기록을 보고 싶을 때  
- **Fake**: 빠른 대체 구현(InMemory 등)으로 테스트할 때  
- **Dummy**: 단순히 파라미터 채우기용

---

## 관련 노트
- [[테스트의 종류]]
- [[unit-test]]