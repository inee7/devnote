# REST API 설계

마이크로서비스 아키텍처로 설계할때 여러 서비스를 조합해서 서비스해야할 때가 있다 그런데 서비스마다 각기 다른 형태의 RET-API포맷으로 인터페이스 제공하면 각서버 API마다 다른 요청/응답 방법을 써야할수도 있고 일관성이 없어 API를 이해하는 데 시간이 필요함 그러면 개발 미팅이 필요 하기도 한다

### REST-API 요소
리소스 : HTTP URI로 표현 행위 : HTTP 메소드로 표현 표현 : JSON을 사용

### 규칙
리소스 이름은 가능하면 명사 계층관계를 가질 수 있고 복수 형태로 행위는 GET,POST,PUT,DELETE 기본 (필요시 PATCH)

URI에 식별자는 문자열을 쓰는것보다 데이터베이스의 주키를 쓰는게 중복 되지 않고 일관성을 줄 수 있다 리소스 이름을 명사로 쓰는건 메소드가 동사 역할을 하기에 의미가 모호해지는걸 방지

GET에서 paging정보와 sort는 query param으로 푼다

API버전을 넣는게 좋은데 uri에 넣는방법과 헤더에 넣는 방법이 있다

400에러일때 응답값에 어떤 부분이 잘 못 됐는지 알려줘도 좋다

## REST-API 특성과 설계

**무상태성** HTTP프로토콜은 무상태성인데 REST-API는 그걸 그대로 이어 받는다. 상태가 없어야 고가용성으로 쉽게 서버를 증설/축소 할 수 있다. 배포도 쉽다.

API를 나눠서 하나의 기능을 실행하면 안된다. 만약 그렇게 한다면 공용 데이터 저장소에 저장해야한다.

**일관성** API스펙의 일관성이 있으면 예측 가능하다.

**멱등성** 여러번 호출해도 한번 호출한것과 같은 결과를 나타낸다 GET은 아무리 실행해도 리소스 상태가 변경되지 않는다. 그래서 안전한 메소드 이면서 멱등성을 가짐 POST는 호출한 횟수 만큼 만들어 질수 있으니 멱등성에서 벗어 날수 있다 PUT, DELETE는 멱등성이 있어야한다.

예를들어 PUT /hotels/912 는 호텔의 isOpened를 변경하는 API라 하자. 멱등성을 고려하지 않고 개발한다면 데이터베이스에 isOpened속성을 not으로 업데이트 한다고 하자. 동시에 API를 두개 호출하면 의도대로 변경할수 없다. 이걸 멱등성 있게 바꾸려면 not이 아닌 바꾸려는 isOpen값을 받아서 그대로 반영하는것이다.

DELETE의 예로 데이터 유무를 확인한 후 삭제한다고 하자. 요청을 했는데 네트워크 유실로 응답을 받지 못했다 다시한번 호출했는데 NOT_FOUND 에러를 받는다면 멱등성을 가지지 못한다. 따라서 값이 없더라도 성공으로 응답해야한다.

#restful
